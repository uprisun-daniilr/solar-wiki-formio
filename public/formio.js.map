{"version":3,"file":"formio.js","mappings":"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","sources":["webpack://solar-wiki-formio/./src/components/google-map.provider.js","webpack://solar-wiki-formio/./src/components/helper.js","webpack://solar-wiki-formio/./src/components/utility-select.component.js","webpack://solar-wiki-formio/./src/index.js"],"sourcesContent":["export class GoogleMapProvider extends Formio.Providers.providers.address\n  .google {\n  constructor(...props) {\n    super(...props);\n  }\n  static get name() {\n    return \"google\";\n  }\n\n  static get displayName() {\n    return \"Google Maps\";\n  }\n\n  updateMap({ lat, lng }) {\n    this.marker.setPosition({\n      lat,\n      lng,\n    });\n    this.map.setCenter(this.marker.position);\n  }\n\n  reverseGeocode(lat, lng) {\n    const geocoder = new google.maps.Geocoder();\n    geocoder.geocode(\n      {\n        location: {\n          lat,\n          lng,\n        },\n      },\n      (results, status) => {\n        const address = results[0];\n\n        if (status === \"OK\" && address) {\n          let isAddressAllowed = true;\n          const autocompleteOptions = this.options.params.autocompleteOptions;\n\n          if (\n            autocompleteOptions.componentRestrictions &&\n            autocompleteOptions.componentRestrictions.country\n          ) {\n            const country = address.address_components.find(\n              (item) => item.types.indexOf(\"country\") !== -1\n            );\n            if (!country) {\n              isAddressAllowed = false;\n            } else if (\n              country.short_name.toLowerCase() !==\n              autocompleteOptions.componentRestrictions.country.toLowerCase()\n            ) {\n              isAddressAllowed = false;\n            }\n          }\n\n          if (!isAddressAllowed) {\n            return;\n          }\n\n          const input = this.element;\n          if (input) {\n            this.onSelectAddress(address, this.element);\n            this.updateMap({\n              lat,\n              lng,\n            });\n          }\n        } else {\n          console.error(\"Geocoder failed due to:\", status);\n        }\n      }\n    );\n  }\n\n  initMap(mapElement, defaultZoom, defaultCenter) {\n    this.map = new google.maps.Map(mapElement, {\n      zoom: defaultZoom,\n      center: this.currentValue || defaultCenter,\n    });\n\n    this.marker = new google.maps.Marker({\n      position: this.currentValue || defaultCenter,\n      map: this.map,\n      draggable: true,\n    });\n\n    if (!this.element.disabled) {\n      google.maps.event.addListener(this.marker, \"dragend\", (event) => {\n        const lat = event.latLng.lat();\n        const lng = event.latLng.lng();\n        this.reverseGeocode(lat, lng);\n      });\n\n      google.maps.event.addListener(this.map, \"click\", (event) => {\n        const lat = event.latLng.lat();\n        const lng = event.latLng.lng();\n        this.reverseGeocode(lat, lng);\n      });\n    }\n\n    if (this.element.value) {\n      var request = {\n        query: this.element.value,\n        fields: [\"name\", \"geometry\"],\n      };\n\n      var service = new google.maps.places.PlacesService(this.map);\n\n      service.findPlaceFromQuery(request, (results, status) => {\n        if (status === google.maps.places.PlacesServiceStatus.OK) {\n          this.map.setCenter(results[0].geometry.location);\n          this.marker.setPosition(results[0].geometry.location);\n        }\n      });\n    }\n  }\n\n  attachAutocomplete(elem, index, onSelectAddress) {\n    this.onSelectAddress = onSelectAddress;\n    this.element = elem;\n\n    const { defaultCenterLat, defaultCenterLng, isMapEnabled, defaultZoom } =\n      this.options.params;\n\n    const mapElement = document.createElement(\"div\");\n    mapElement.style.height = \"400px\";\n    mapElement.style[\"margin-top\"] = \"16px\";\n    mapElement.style.width = \"100%\";\n    mapElement.style.background = \"#eee\";\n\n    if (isMapEnabled) {\n      elem.parentNode.insertBefore(mapElement, elem.nextSibling);\n    }\n\n    Formio.libraryReady(this.getLibraryName()).then(() => {\n      const autocomplete = new google.maps.places.Autocomplete(\n        elem,\n        this.autocompleteOptions\n      );\n\n      autocomplete.addListener(\"place_changed\", () => {\n        const place = this.filterPlace(autocomplete.getPlace());\n\n        const location = place.geometry\n          ? {\n              lat: place.geometry.location.lat(),\n              lng: place.geometry.location.lng(),\n            }\n          : null;\n\n        if (isMapEnabled) {\n          this.updateMap(location);\n        }\n\n        place.formattedPlace = _.get(\n          autocomplete,\n          \"gm_accessors_.place.se.formattedPrediction\",\n          place[this.alternativeDisplayValueProperty]\n        );\n        onSelectAddress(place, elem, index);\n      });\n\n      if (isMapEnabled) {\n        this.initMap(mapElement, defaultZoom, {\n          lat: defaultCenterLat,\n          lng: defaultCenterLng,\n        });\n      }\n    });\n  }\n  static initialize() {\n    const addressEditForm = Formio.Components.components.address.editForm;\n\n    Formio.Components.components.address.editForm = (...args) => {\n      const editForm = addressEditForm(...args);\n\n      const tabs = editForm.components.find(({ type }) => type === \"tabs\");\n\n      const provider = tabs.components.find(({ key }) => key === \"provider\");\n\n      provider.components.push({\n        type: \"checkbox\",\n        input: true,\n        inputType: \"checkbox\",\n        key: \"providerOptions.params.isMapEnabled\",\n        label: \"Show Map\",\n        defaultValue: false,\n        conditional: {\n          json: {\n            \"===\": [\n              {\n                var: \"data.provider\",\n              },\n              \"google\",\n            ],\n          },\n        },\n      });\n\n      provider.components.push({\n        type: \"number\",\n        input: true,\n        key: \"providerOptions.params.defaultZoom\",\n        label: \"Zoom\",\n        defaultValue: 8,\n        conditional: {\n          json: {\n            \"===\": [\n              {\n                var: \"data.provider\",\n              },\n              \"google\",\n            ],\n          },\n        },\n      });\n\n      provider.components.push({\n        type: \"number\",\n        input: true,\n        key: \"providerOptions.params.defaultCenterLat\",\n        label: \"Default Center Latitude\",\n        defaultValue: 40.712776,\n        conditional: {\n          json: {\n            \"===\": [\n              {\n                var: \"data.provider\",\n              },\n              \"google\",\n            ],\n          },\n        },\n      });\n\n      provider.components.push({\n        type: \"number\",\n        input: true,\n        key: \"providerOptions.params.defaultCenterLng\",\n        label: \"Default Center Longitude\",\n        defaultValue: -74.0059728,\n        conditional: {\n          json: {\n            \"===\": [\n              {\n                var: \"data.provider\",\n              },\n              \"google\",\n            ],\n          },\n        },\n      });\n\n      return editForm;\n    };\n  }\n}\n","export const getRoot = (component) => {\n  if (component.root && component.root !== component) {\n    return getRoot(component.root);\n  } else {\n    return component;\n  }\n};\n","import { getRoot } from \"./helper\";\n\nexport class UtilityProviderSelectComponent extends Formio.Components.components\n  .select {\n  static schema(...extend) {\n    return Formio.Components.components.select.schema(\n      {\n        type: \"utilityproviderselect\",\n        label: \"Utility provider select\",\n        key: \"utilityproviderselect\",\n        dataSrc: \"url\",\n        valueProperty: \"\",\n        selectValues: \"outputs.utility_info\",\n        template: \"<span>{{ item.utility_name }}</span>\",\n        data: {\n          url: \"\",\n        },\n      },\n      ...extend\n    );\n  }\n\n  static get builderInfo() {\n    return {\n      title: \"Utility provider select\",\n      group: \"advanced\",\n      icon: \"fa fa-list\",\n      weight: 70,\n      schema: UtilityProviderSelectComponent.schema(),\n    };\n  }\n\n  loadItems(url, search, headers, options, method) {\n    const form = getRoot(this);\n\n    const address = form.getComponent(\"address\");\n\n    if (!address) return [];\n\n    const addressValue = address.getValue();\n\n    const location = addressValue?.data?.address?.geometry?.location;\n\n    if (!location) {\n      return;\n    }\n\n    const { lat, lng } = location;\n\n    console.log(\"location: \", { lat, lng });\n\n    const api_key = this.component.api_key;\n\n    if (lat && lng) {\n      url = `https://developer.nrel.gov/api/utility_rates/v3.json?api_key=${api_key}&lat=${lat()}&lon=${lng()}`;\n    }\n\n    super\n      .loadItems(url, search, headers, options, method)\n      .then((items) => console.log(items));\n\n    return super.loadItems(url, search, headers, options, method);\n  }\n\n  static editForm(...extend) {\n    return Formio.Components.components.select.editForm(\n      [\n        {\n          key: \"data\",\n          components: [\n            {\n              type: \"textfield\",\n              input: true,\n              label: \"API Key\",\n              key: \"api_key\",\n              weight: 20,\n              placeholder: \"Enter your API key\",\n              tooltip: \"The API key for the data source\",\n            },\n          ],\n        },\n      ],\n      ...extend\n    );\n  }\n}\n","import { GoogleMapProvider } from \"./components/google-map.provider\";\nimport { UtilityProviderSelectComponent } from \"./components/utility-select.component\";\n\n(() => {\n  console.info(\"Custom components was loaded.\");\n  GoogleMapProvider.initialize();\n\n  Formio.Providers.addProvider(\"address\", \"google\", GoogleMapProvider);\n\n  Formio.Components.addComponent(\n    \"utilityproviderselect\",\n    UtilityProviderSelectComponent\n  );\n})();\n"],"names":["GoogleMapProvider","_Formio$Providers$pro","_classCallCheck","_len","arguments","length","props","Array","_key","_callSuper","concat","_inherits","Formio","Providers","providers","address","google","key","get","value","addressEditForm","Components","components","editForm","apply","provider","find","_ref2","type","_ref3","push","input","inputType","label","defaultValue","conditional","json","var","_ref","lat","lng","this","marker","setPosition","map","setCenter","position","_this","maps","Geocoder","geocode","location","results","status","isAddressAllowed","autocompleteOptions","options","params","componentRestrictions","country","address_components","item","types","indexOf","short_name","toLowerCase","element","onSelectAddress","updateMap","console","error","mapElement","defaultZoom","defaultCenter","_this2","Map","zoom","center","currentValue","Marker","draggable","disabled","event","addListener","latLng","reverseGeocode","request","query","fields","places","PlacesService","findPlaceFromQuery","PlacesServiceStatus","OK","geometry","elem","index","_this3","_this$options$params","defaultCenterLat","defaultCenterLng","isMapEnabled","document","createElement","style","height","width","background","parentNode","insertBefore","nextSibling","libraryReady","getLibraryName","then","autocomplete","Autocomplete","place","filterPlace","getPlace","formattedPlace","_","alternativeDisplayValueProperty","initMap","getRoot","component","root","UtilityProviderSelectComponent","_Formio$Components$co","select","_Formio$Components$co2","extend","schema","dataSrc","valueProperty","selectValues","template","data","url","title","group","icon","weight","_Formio$Components$co3","_len2","_key2","placeholder","tooltip","search","headers","method","_addressValue$data","getComponent","addressValue","getValue","log","api_key","_get","_getPrototypeOf","prototype","call","items","info","initialize","addProvider","addComponent"],"sourceRoot":""}